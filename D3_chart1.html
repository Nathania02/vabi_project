<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Health Outcomes Complete Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body { 
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
    }
    
    .navbar {
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 1000;
    }
    
    .navbar.sticky-top {
      background-color: #f8f9fa !important;
    }
    
    /* Highlight active topic in dropdown */
    .dropdown-item.active-topic {
      background-color: #f0f0ff;
      color: #667eea;
      font-weight: 600;
    }
    
    .dropdown-item.active-topic:hover {
      background-color: #e5e5ff;
    }
    
    /* Multi-level dropdown styling */
    .dropdown-submenu {
      position: relative;
    }
    
    .dropdown-submenu .dropdown-menu {
      position: absolute;
      top: 0;
      left: 100%;
      margin-top: -1px;
      margin-left: -1px;
      max-height: 80vh;
      overflow-y: auto;
      min-width: 200px;
      width: max-content;
      max-width: 300px;
    }
    
    /* Flip submenu to left if it would go off-screen */
    .dropdown-submenu.dropstart .dropdown-menu {
      left: auto;
      right: 100%;
      margin-left: 0;
      margin-right: -1px;
    }
    
    .dropdown-submenu:hover > .dropdown-menu {
      display: block;
    }
    
    .dropdown-item.has-submenu {
      position: relative;
      padding-right: 2rem;
    }
    
    .dropdown-item.has-submenu::after {
      content: "‚Ä∫";
      position: absolute;
      right: 1rem;
      font-weight: bold;
    }
    
    .dropdown-submenu.dropstart .dropdown-item.has-submenu::after {
      content: "‚Äπ";
    }
    
    /* Prevent horizontal scroll on body */
    body {
      overflow-x: hidden;
    }
    
    .content-wrapper {
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .breadcrumb-nav {
      background: #f8f9fa;
      padding: 12px 20px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    
    .breadcrumb {
      margin: 0;
    }
    
    h1 { 
      font-size: 1.75rem; 
      margin: 0 0 10px;
      color: #333;
    }
    
    .sub { 
      color: #666; 
      margin: 0 0 20px;
      font-size: 1rem;
    }
    
    .viz-box { 
      border: 1px solid #e5e5e5; 
      border-radius: 8px; 
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .d3-box { 
      border: 1px solid #e5e5e5; 
      border-radius: 8px; 
      margin-top: 16px; 
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .note { 
      font-size: 0.9rem; 
      color: #666; 
      margin-top: 6px;
    }
    
    #d3chart { 
      width: 100%; 
      height: auto;
    }

    /* Quick Navigation Styles */
    .quick-nav {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }

    .quick-nav h3 {
      margin: 0 0 15px 0;
      font-size: 1.2rem;
    }

    .nav-links {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }

    .nav-link-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      padding: 10px 15px;
      border-radius: 6px;
      text-decoration: none;
      transition: background-color 0.3s ease;
      font-size: 0.9rem;
    }

    .nav-link-btn:hover {
      background: rgba(255,255,255,0.3);
      color: white;
      text-decoration: none;
    }

    /* Section styling */
    .chart-section {
      scroll-margin-top: 100px; /* Account for sticky navbar */
    }

    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }

    @media (max-width: 768px) {
      .nav-links {
        grid-template-columns: 1fr;
      }
    }


  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">
        <span style="color: #667eea;">VABI</span> Project
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" href="index.html">Home</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="dashboardDropdown" role="button" data-bs-toggle="dropdown">
              Dashboards
            </a>
            <ul class="dropdown-menu">
              <!-- Human Trafficking Topic -->
              <li class="dropdown-submenu">
                <a class="dropdown-item has-submenu" href="#">Human Trafficking</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="D1_chart1.html">Types of Trafficking</a></li>
                  <li><a class="dropdown-item" href="D1_chart5.html">Flow of Trafficking</a></li>
                  <li><a class="dropdown-item" href="D1_chart2.html">Victims trafficked to other countries</a></li>
                  <li><a class="dropdown-item" href="D1_chart3.html">Trend of Victims being trafficked & Organ Removal</a></li>
                  <li><a class="dropdown-item" href="D1_GDP_Analysis.html">GDP Analysis</a></li>
                </ul>
              </li>

              <!-- Organ Demand and Supply Topic -->
              <li class="dropdown-submenu">
                <a class="dropdown-item has-submenu" href="#">Organ Supply and Demand</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="D2_chart1.html">Organ Supply By Country</a></li>
                  <li><a class="dropdown-item" href="D2_chart2.html">Usable Organ Percentage</a></li>
                  <li><a class="dropdown-item" href="D2_chart3.html">Demand and Supply of Organs</a></li>
                  <li><a class="dropdown-item" href="D2_chart4.html">Transplant done vs Waiting list</a></li>
                  <li><a class="dropdown-item" href="D2_chart5.html">Mortality Rate</a></li>
                </ul>
              </li>
              
              <!-- Health Outcomes Topic -->
              <li class="dropdown-submenu">
                <a class="dropdown-item has-submenu" href="#">Health Outcomes</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="D3_chart1.html">Surgery Cost Comparison</a></li>
                  <li><a class="dropdown-item" href="D3_chart2.html">Hidden Costs After Surgery</a></li>
                  <li><a class="dropdown-item" href="D3_chart3.html">Health Outcomes Analysis</a></li>
                  <li><a class="dropdown-item" href="D3_chart4.html">Long Term Total Cost</a></li>
                </ul>
              </li>

              <!-- Solution -->
              <li class="dropdown-submenu">
                <a class="dropdown-item has-submenu" href="#">Solution</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="D4_chart1.html">Pathways to More Organs</a></li>
                  <li><a class="dropdown-item" href="D4_chart2.html">US vs Iran: Spotlight Metrics</a></li>
                  <li><a class="dropdown-item" href="D4_chart3.html">What if we do nothing?</a></li>
                  <li><a class="dropdown-item" href="D4_chart4.html">Iran's Policy Reforms</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#about">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#contact">Contact</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  


  <!-- Breadcrumb Navigation -->
  <div class="breadcrumb-nav">
    <div class="container-fluid">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item"><a href="index.html#health">Health Outcomes</a></li>
          <li class="breadcrumb-item active" aria-current="page">Complete Health Outcomes Dashboard</li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-wrapper">
    <h1>Health Outcomes Complete Dashboard</h1>
    <p class="sub">Comprehensive analysis of legal vs illegal transplant costs, outcomes, and long-term implications</p>

    <!-- Quick Navigation -->
    <div class="quick-nav">
      <h3>üìä Jump to Section</h3>
      <div class="nav-links">
        <a href="#chart1" class="nav-link-btn">1. Surgery Cost Comparison</a>
        <a href="#chart2" class="nav-link-btn">2. The Hidden Cost Revelation</a>
        <a href="#chart3" class="nav-link-btn">3. Health Outcomes Analysis</a>
        <a href="#chart4" class="nav-link-btn">4. Long Term Total Cost</a>
      </div>
    </div>

    <!-- CHART 1: Surgery Cost Comparison -->
    <section id="chart1" class="chart-section" style="margin-bottom: 60px;">
      <h2 style="color: #667eea; margin-bottom: 10px; font-size: 1.5rem; border-bottom: 2px solid #667eea; padding-bottom: 8px;">1. Surgery Cost Comparison</h2>
      <p style="color: #666; margin-bottom: 20px; font-size: 1rem;">Initial surgical costs between legal and illegal transplant procedures</p>
      
      <div class="viz-box">
        <div class='tableauPlaceholder' id='viz1730995200000' style='position: relative'>
          <noscript>
            <a href='#'>
              <img 
                alt='Surgery Cost Comparison' 
                src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Su&#47;SurgeryCost&#47;chart1&#47;1_rss.png' 
                style='border: none' />
            </a>
          </noscript>
          <object class='tableauViz'  style='display:none;'>
            <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> 
            <param name='embed_code_version' value='3' /> 
            <param name='site_root' value='' />
            <param name='name' value='SurgeryCost&#47;chart1' />
            <param name='tabs' value='no' />
            <param name='toolbar' value='yes' />
            <param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Su&#47;SurgeryCost&#47;chart1&#47;1.png' /> 
            <param name='animate_transition' value='yes' />
            <param name='display_static_image' value='yes' />
            <param name='display_spinner' value='yes' />
            <param name='display_overlay' value='yes' />
            <param name='display_count' value='yes' />
            <param name='language' value='en-US' />
            <param name='filter' value='publish=yes' />
          </object>
        </div>                         
      </div>
    </section>

    <!-- CHART 2: Hidden Costs After Surgery -->
    <section id="chart2" class="chart-section" style="margin-bottom: 60px;">
      <h2 style="color: #667eea; margin-bottom: 10px; font-size: 1.5rem; border-bottom: 2px solid #667eea; padding-bottom: 8px;">2. The Hidden Cost Revelation</h2>      

      
      <!-- D3 Animated Chart -->
      <div class="viz-box">
        <div id="d3-cost-revelation" style="width: 100%; height: 500px; position: relative;">
          <svg id="cost-chart" width="100%" height="100%"></svg>
        </div>
        
        <!-- Controls -->
        <div style="text-align: center; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
          <button id="play-btn" class="btn btn-primary" style="margin-right: 10px;">‚ñ∂Ô∏è Play Animation</button>
          <button id="reset-btn" class="btn btn-outline-secondary" style="margin-right: 10px;">üîÑ Reset</button>
          <span style="margin-left: 15px; color: #666;">Step: <span id="current-step">1</span> of 5</span>
        </div>
      </div>
    </section>

    <!-- CHART 3: Health Outcomes Analysis -->
    <section id="chart3" class="chart-section" style="margin-bottom: 60px;">
      <h2 style="color: #667eea; margin-bottom: 10px; font-size: 1.5rem; border-bottom: 2px solid #667eea; padding-bottom: 8px;">3. Health Outcomes Analysis</h2>
      <p style="color: #666; margin-bottom: 20px; font-size: 1rem;">The stark reality of survival rates and complications in legal vs illegal transplants</p>

      <!-- D3 Animated Chart -->
      <div class="viz-box">
        <div id="d3-health-outcomes" style="width: 100%; height: 500px; position: relative;">
          <svg id="health-chart" width="100%" height="100%"></svg>
        </div>
        
        <!-- Controls -->
        <div style="text-align: center; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
          <button id="health-play-btn" class="btn btn-primary" style="margin-right: 10px;">‚ñ∂Ô∏è Play Animation</button>
          <button id="health-reset-btn" class="btn btn-outline-secondary" style="margin-right: 10px;">üîÑ Reset</button>
          <span style="margin-left: 15px; color: #666;">Step: <span id="health-current-step">1</span> of 4</span>
        </div>
      </div>
    </section>

    <!-- CHART 4: Long Term Total Cost -->
    <section id="chart4" class="chart-section" style="margin-bottom: 0px; padding: 40px 20px; background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%); border-radius: 15px; margin-top: 20px;">
      <h2 style="color: #667eea; margin-bottom: 15px; font-size: 2rem; border-bottom: 3px solid #667eea; padding-bottom: 12px; font-weight: bold; text-align: center;">4. Long Term Total Cost</h2>
      <p style="color: #666; margin-bottom: 30px; font-size: 1.1rem; line-height: 1.5; text-align: center; max-width: 800px; margin-left: auto; margin-right: auto;">Long-term financial implications of legal vs illegal organ transplants</p>
      
      <div class="viz-box" style="padding: 25px; margin: 20px 0; box-shadow: 0 4px 20px rgba(0,0,0,0.15); border-radius: 12px;">
        <div class='tableauPlaceholder' id='viz1730995200003' style='position: relative; min-height: 600px;'>
          <noscript>
            <a href='#'>
              <img 
                alt='Long Term Total Cost' 
                src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Lo&#47;LongTermTotalCost&#47;chart4&#47;1_rss.png' 
                style='border: none' />
            </a>
          </noscript>
          <object class='tableauViz'  style='display:none;'>
            <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> 
            <param name='embed_code_version' value='3' /> 
            <param name='site_root' value='' />
            <param name='name' value='LongTermTotalCost&#47;chart4' />
            <param name='tabs' value='no' />
            <param name='toolbar' value='yes' />
            <param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Lo&#47;LongTermTotalCost&#47;chart4&#47;1.png' /> 
            <param name='animate_transition' value='yes' />
            <param name='display_static_image' value='yes' />
            <param name='display_spinner' value='yes' />
            <param name='display_overlay' value='yes' />
            <param name='display_count' value='yes' />
            <param name='language' value='en-US' />
            <param name='filter' value='publish=yes' />
          </object>
        </div>                         
      </div>
    </section>
  </div>

  <!-- Tableau v1 embed script -->
  <script src="https://public.tableau.com/javascripts/api/viz_v1.js"></script>
  <!-- D3.js library -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <script>
    // D3 Cost Revelation Animation - Grouped Bar Chart Format
    document.addEventListener('DOMContentLoaded', function() {
      // Data matching your Tableau chart format
      const costCategories = [
        { name: 'Surgery Cost', illegal: 5, legal: 48, color: '#5a9bd4' },
        { name: 'Complications Cost', illegal: 60, legal: 15, color: '#70ad85' },
        { name: 'Readmission Cost', illegal: 34, legal: 12, color: '#70ad85' },
        { name: 'Hospital Care', illegal: 1, legal: 15, color: '#70ad85' },
        { name: 'Post Op Care', illegal: 0, legal: 5, color: '#70ad85' },
        { name: 'Medications Annual', illegal: 1, legal: 4, color: '#70ad85' }
      ];

      const animationSteps = [
        { 
          step: 1, 
          title: "Surgery Cost Only", 
          message: '"Illegal seems much cheaper."',
          showCategories: ['Surgery Cost']
        },
        { 
          step: 2, 
          title: "Add Complications", 
          message: '"But the hidden burden starts to appear."',
          showCategories: ['Surgery Cost', 'Complications Cost']
        },
        { 
          step: 3, 
          title: "Add Readmissions", 
          message: '"Now the real damage compounds."',
          showCategories: ['Surgery Cost', 'Complications Cost', 'Readmission Cost']
        },
        { 
          step: 4, 
          title: "Add Hospital & Post-Op Care", 
          message: '"Almost the entire budget goes to fixing harm."',
          showCategories: ['Surgery Cost', 'Complications Cost', 'Readmission Cost', 'Hospital Care', 'Post Op Care', 'Medications Annual']
        },
        { 
          step: 5, 
          title: "Final Revelation", 
          message: '"The operation may begin cheaply‚Ä¶ but the aftermath multiplies the cost."',
          showCategories: ['Surgery Cost', 'Complications Cost', 'Readmission Cost', 'Hospital Care', 'Post Op Care', 'Medications Annual'],
          highlight: true
        }
      ];

      let currentStep = 0;
      let isPlaying = false;

      const svg = d3.select('#cost-chart');
      const container = document.getElementById('d3-cost-revelation');
      
      function initChart() {
        const width = container.clientWidth;
        const height = 500;
        const margin = {top: 40, right: 40, bottom: 80, left: 60};
        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom;

        svg.selectAll('*').remove();
        svg.attr('width', width).attr('height', height);

        const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

        // Scales - start with only first step categories
        const yScale = d3.scaleLinear().domain([0, 70]).range([chartHeight, 0]);
        const initialCategories = costCategories.filter(d => animationSteps[0].showCategories.includes(d.name));
        const x0Scale = d3.scaleBand().domain(initialCategories.map(d => d.name)).range([0, chartWidth]).padding(0.1);
        const x1Scale = d3.scaleBand().domain(['Illegal', 'Legal']).range([0, x0Scale.bandwidth()]).padding(0.05);

        // Axes
        g.append('g')
          .attr('class', 'y-axis')
          .call(d3.axisLeft(yScale).tickFormat(d => d + '%'));

        g.append('g')
          .attr('class', 'x-axis')
          .attr('transform', `translate(0,${chartHeight})`)
          .call(d3.axisBottom(x0Scale))
          .selectAll('text')
          .remove(); // Remove default axis text labels

        // Axis labels
        g.append('text')
          .attr('class', 'y-label')
          .attr('transform', 'rotate(-90)')
          .attr('y', 0 - margin.left + 15)
          .attr('x', 0 - (chartHeight / 2))
          .style('text-anchor', 'middle')
          .style('font-size', '14px')
          .style('fill', '#666')
          .text('% of Total Cost of Transplant (USD)');

        // Title
        g.append('text')
          .attr('class', 'chart-title')
          .attr('x', chartWidth / 2)
          .attr('y', -10)
          .style('text-anchor', 'middle')
          .style('font-size', '16px')
          .style('font-weight', 'bold')
          .style('fill', '#333')
          .text('Hidden Costs After Surgery');

        // Add initial category labels
        const initialVisibleData = costCategories.filter(d => animationSteps[0].showCategories.includes(d.name));
        g.selectAll('.category-label')
          .data(initialVisibleData)
          .enter()
          .append('text')
          .attr('class', 'category-label')
          .attr('x', d => x0Scale(d.name) + x0Scale.bandwidth() / 2)
          .attr('y', chartHeight + 30)
          .style('text-anchor', 'middle')
          .style('font-size', '11px')
          .style('font-weight', '500')
          .style('fill', '#333')
          .text(d => {
            const shortNames = {
              'Surgery Cost': 'Surgery Cost',
              'Complications Cost': 'Complications',
              'Readmission Cost': 'Readmissions', 
              'Hospital Care': 'Hospital Care',
              'Post Op Care': 'Post-Op Care',
              'Medications Annual': 'Medications'
            };
            return shortNames[d.name] || d.name;
          });

        return {g, x0Scale, x1Scale, yScale, chartHeight, chartWidth};
      }

      function updateChart(stepIndex) {
        const stepData = animationSteps[stepIndex];
        const {g, yScale, chartHeight} = window.chartElements;

        // Update step counter
        document.getElementById('current-step').textContent = stepData.step;

        // Filter data for current step
        const visibleData = costCategories.filter(d => stepData.showCategories.includes(d.name));

        // Update x-axis scale and axis
        const newX0Scale = d3.scaleBand().domain(visibleData.map(d => d.name)).range([0, window.chartElements.chartWidth]).padding(0.1);
        const newX1Scale = d3.scaleBand().domain(['Illegal', 'Legal']).range([0, newX0Scale.bandwidth()]).padding(0.05);
        
        // Update the stored scales
        window.chartElements.x0Scale = newX0Scale;
        window.chartElements.x1Scale = newX1Scale;

        // Update x-axis but remove text labels
        g.select('.x-axis')
          .transition()
          .duration(600)
          .call(d3.axisBottom(newX0Scale))
          .selectAll('text')
          .remove();

        // Update category labels with proper data binding
        const categoryLabels = g.selectAll('.category-label')
          .data(visibleData, d => d.name);

        // Remove exiting labels
        categoryLabels.exit().remove();

        // Add new labels
        const newLabels = categoryLabels.enter()
          .append('text')
          .attr('class', 'category-label')
          .style('opacity', 0);

        // Update all labels (existing + new)
        categoryLabels.merge(newLabels)
          .transition()
          .duration(600)
          .style('opacity', 1)
          .attr('x', d => newX0Scale(d.name) + newX0Scale.bandwidth() / 2)
          .attr('y', chartHeight + 25)
          .style('text-anchor', 'middle')
          .style('font-size', '12px')
          .style('font-weight', '600')
          .style('fill', '#333')
          .text(d => {
            const shortNames = {
              'Surgery Cost': 'Surgery',
              'Complications Cost': 'Complications',
              'Readmission Cost': 'Readmissions', 
              'Hospital Care': 'Hospital',
              'Post Op Care': 'Post-Op',
              'Medications Annual': 'Medications'
            };
            return shortNames[d.name] || d.name;
          });

        // Create grouped bars
        const categoryGroups = g.selectAll('.category-group')
          .data(visibleData, d => d.name);

        // Remove exiting groups
        categoryGroups.exit()
          .transition()
          .duration(400)
          .style('opacity', 0)
          .remove();

        // Add new groups
        const categoryGroupsEnter = categoryGroups.enter()
          .append('g')
          .attr('class', 'category-group')
          .style('opacity', 0);

        const categoryGroupsMerge = categoryGroupsEnter.merge(categoryGroups);

        categoryGroupsMerge
          .transition()
          .duration(600)
          .style('opacity', 1)
          .attr('transform', d => `translate(${newX0Scale(d.name)},0)`);

        // Illegal bars
        const illegalBars = categoryGroupsMerge.selectAll('.illegal-bar')
          .data(d => [d]);

        const illegalBarsEnter = illegalBars.enter()
          .append('rect')
          .attr('class', 'illegal-bar')
          .attr('y', chartHeight)
          .attr('height', 0)
          .attr('fill', '#e74c3c');

        illegalBars.merge(illegalBarsEnter)
          .transition()
          .duration(800)
          .delay((d, i) => i * 100)
          .attr('x', newX1Scale('Illegal'))
          .attr('width', newX1Scale.bandwidth())
          .attr('y', d => yScale(d.illegal))
          .attr('height', d => chartHeight - yScale(d.illegal))
          .attr('fill', '#e74c3c')
          .style('filter', stepData.highlight ? 'drop-shadow(0 0 8px rgba(231, 76, 60, 0.6))' : 'none');

        // Legal bars
        const legalBars = categoryGroupsMerge.selectAll('.legal-bar')
          .data(d => [d]);

        const legalBarsEnter = legalBars.enter()
          .append('rect')
          .attr('class', 'legal-bar')
          .attr('y', chartHeight)
          .attr('height', 0)
          .attr('fill', '#5a9bd4');

        legalBars.merge(legalBarsEnter)
          .transition()
          .duration(800)
          .delay((d, i) => i * 100)
          .attr('x', newX1Scale('Legal'))
          .attr('width', newX1Scale.bandwidth())
          .attr('y', d => yScale(d.legal))
          .attr('height', d => chartHeight - yScale(d.legal))
          .style('opacity', stepData.highlight ? 0.4 : 1);

        // Add value labels on bars
        const illegalLabels = categoryGroupsMerge.selectAll('.illegal-label')
          .data(d => d.illegal > 0 ? [d] : []);

        const illegalLabelsEnter = illegalLabels.enter()
          .append('text')
          .attr('class', 'illegal-label')
          .style('text-anchor', 'middle')
          .style('font-size', '12px')
          .style('font-weight', 'bold')
          .style('fill', 'white');

        illegalLabels.merge(illegalLabelsEnter)
          .transition()
          .duration(800)
          .delay((d, i) => i * 100)
          .attr('x', newX1Scale('Illegal') + newX1Scale.bandwidth()/2)
          .attr('y', d => yScale(d.illegal) + (chartHeight - yScale(d.illegal))/2 + 4)
          .text(d => d.illegal + '%');

        const legalLabels = categoryGroupsMerge.selectAll('.legal-label')
          .data(d => d.legal > 0 ? [d] : []);

        const legalLabelsEnter = legalLabels.enter()
          .append('text')
          .attr('class', 'legal-label')
          .style('text-anchor', 'middle')
          .style('font-size', '12px')
          .style('font-weight', 'bold')
          .style('fill', 'white');

        legalLabels.merge(legalLabelsEnter)
          .transition()
          .duration(800)
          .delay((d, i) => i * 100)
          .attr('x', newX1Scale('Legal') + newX1Scale.bandwidth()/2)
          .attr('y', d => yScale(d.legal) + (chartHeight - yScale(d.legal))/2 + 4)
          .text(d => d.legal + '%');

        // Legend
        if (stepIndex === 0) {
          const legend = g.append('g').attr('class', 'legend')
            .attr('transform', `translate(${window.chartElements.chartWidth - 120}, 20)`);

          legend.append('rect')
            .attr('width', 15).attr('height', 15)
            .attr('fill', '#e74c3c');
          legend.append('text')
            .attr('x', 20).attr('y', 12)
            .style('font-size', '12px').style('fill', '#666')
            .text('Illegal');

          legend.append('rect')
            .attr('y', 20)
            .attr('width', 15).attr('height', 15)
            .attr('fill', '#5a9bd4');
          legend.append('text')
            .attr('x', 20).attr('y', 32)
            .style('font-size', '12px').style('fill', '#666')
            .text('Legal');
        }
      }

      function playAnimation() {
        if (isPlaying) return;
        isPlaying = true;
        document.getElementById('play-btn').textContent = '‚è∏Ô∏è Playing...';
        document.getElementById('play-btn').disabled = true;

        function nextStep() {
          if (currentStep < animationSteps.length - 1) {
            currentStep++;
            updateChart(currentStep);
            setTimeout(nextStep, 2000);
          } else {
            isPlaying = false;
            document.getElementById('play-btn').textContent = '‚ñ∂Ô∏è Play Again';
            document.getElementById('play-btn').disabled = false;
          }
        }
        nextStep();
      }

      function resetChart() {
        currentStep = 0;
        isPlaying = false;
        document.getElementById('play-btn').textContent = '‚ñ∂Ô∏è Play Animation';
        document.getElementById('play-btn').disabled = false;
        updateChart(currentStep);
      }

      // Initialize
      window.chartElements = initChart();
      updateChart(currentStep);

      // Event listeners
      document.getElementById('play-btn').addEventListener('click', playAnimation);
      document.getElementById('reset-btn').addEventListener('click', resetChart);

      // Resize handler
      window.addEventListener('resize', function() {
        window.chartElements = initChart();
        updateChart(currentStep);
      });
    });

    // D3 Health Outcomes Animation
    document.addEventListener('DOMContentLoaded', function() {
      // Health outcomes data
      const healthData = [
        { name: '1-Year Survival', illegal: 73.02, legal: 91.24, color: '#27ae60' },
        { name: '5-Year Survival', illegal: 53.97, legal: 85.40, color: '#f39c12' },
        { name: 'Complication Rate', illegal: 60.32, legal: 26.28, color: '#e74c3c' }
      ];

      const healthSteps = [
        { 
          step: 1, 
          title: "1-Year Survival Rates", 
          message: 'Initial outcomes appear promising for both pathways',
          showMetrics: ['1-Year Survival']
        },
        { 
          step: 2, 
          title: "5-Year Survival Rates", 
          message: 'Long-term survival reveals significant disparities',
          showMetrics: ['1-Year Survival', '5-Year Survival']
        },
        { 
          step: 3, 
          title: "Complication Rates", 
          message: 'Post-operative complications demonstrate stark differences',
          showMetrics: ['1-Year Survival', '5-Year Survival', 'Complication Rate']
        },
        { 
          step: 4, 
          title: "Complete Analysis", 
          message: 'Comprehensive view of health outcome disparities',
          showMetrics: ['1-Year Survival', '5-Year Survival', 'Complication Rate']
        }
      ];

      let healthCurrentStep = 0;
      let healthIsPlaying = false;

      const healthSvg = d3.select('#health-chart');
      const healthContainer = document.getElementById('d3-health-outcomes');
      
      function initHealthChart() {
        const width = healthContainer.clientWidth;
        const height = 500;
        const margin = {top: 60, right: 60, bottom: 40, left: 150};
        const chartWidth = width - margin.left - margin.right;
        const chartHeight = height - margin.top - margin.bottom;

        healthSvg.selectAll('*').remove();
        healthSvg.attr('width', width).attr('height', height);

        const g = healthSvg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

        // Scales for horizontal bars
        const xScale = d3.scaleLinear().domain([0, 100]).range([0, chartWidth]);
        const yScale = d3.scaleBand().domain(healthData.map(d => d.name)).range([0, chartHeight]).padding(0.3);
        const y1Scale = d3.scaleBand().domain(['Legal', 'Illegal']).range([0, yScale.bandwidth()]).padding(0.1);

        // Axes
        g.append('g')
          .attr('class', 'health-x-axis')
          .attr('transform', `translate(0,${chartHeight})`)
          .call(d3.axisBottom(xScale).tickFormat(d => d + '%'));

        g.append('g')
          .attr('class', 'health-y-axis')
          .call(d3.axisLeft(yScale));

        // X-axis label
        g.append('text')
          .attr('class', 'health-x-label')
          .attr('x', chartWidth / 2)
          .attr('y', chartHeight + 35)
          .style('text-anchor', 'middle')
          .style('font-size', '14px')
          .style('fill', '#666')
          .text('Percentage (%)');

        // Chart title
        g.append('text')
          .attr('class', 'health-title')
          .attr('x', chartWidth / 2)
          .attr('y', -10)
          .style('text-anchor', 'middle')
          .style('font-size', '16px')
          .style('font-weight', 'bold')
          .style('fill', '#333')
          .text('Health Outcomes Analysis');

        return {g, xScale, yScale, y1Scale, chartHeight, chartWidth};
      }

      function updateHealthChart(stepIndex) {
        const stepData = healthSteps[stepIndex];
        const {g, xScale, yScale, y1Scale, chartHeight, chartWidth} = window.healthChartElements;

        // Update step counter
        document.getElementById('health-current-step').textContent = stepData.step;

        // Get all data up to current step (cumulative display)
        const visibleData = healthData.slice(0, stepIndex + 1);

        // Update y-axis scale for visible data
        const newYScale = d3.scaleBand().domain(visibleData.map(d => d.name)).range([0, chartHeight]).padding(0.3);
        const newY1Scale = d3.scaleBand().domain(['Legal', 'Illegal']).range([0, newYScale.bandwidth()]).padding(0.1);

        // Update y-axis
        g.select('.health-y-axis')
          .transition()
          .duration(600)
          .call(d3.axisLeft(newYScale));

        // Create metric groups
        const metricGroups = g.selectAll('.health-metric-group')
          .data(visibleData, d => d.name);

        // Remove exiting groups
        metricGroups.exit()
          .transition()
          .duration(400)
          .style('opacity', 0)
          .remove();

        // Add new groups
        const metricGroupsEnter = metricGroups.enter()
          .append('g')
          .attr('class', 'health-metric-group')
          .style('opacity', 0);

        const metricGroupsMerge = metricGroupsEnter.merge(metricGroups);

        // Position groups
        metricGroupsMerge
          .transition()
          .duration(800)
          .style('opacity', 1)
          .attr('transform', d => `translate(0, ${newYScale(d.name)})`);

        // Legal bars (always first, blue/green)
        const legalBars = metricGroupsMerge.selectAll('.legal-health-bar')
          .data(d => [d]);

        const legalBarsEnter = legalBars.enter()
          .append('rect')
          .attr('class', 'legal-health-bar')
          .attr('x', 0)
          .attr('width', 0)
          .attr('y', newY1Scale('Legal'))
          .attr('height', newY1Scale.bandwidth());

        legalBars.merge(legalBarsEnter)
          .transition()
          .duration(1000)
          .delay((d, i) => i * 400)
          .attr('x', 0)
          .attr('width', d => xScale(d.legal))
          .attr('y', newY1Scale('Legal'))
          .attr('height', newY1Scale.bandwidth())
          .attr('fill', '#5a9bd4')
          .style('opacity', 1);

        // Illegal bars (second, red/orange)
        const illegalBars = metricGroupsMerge.selectAll('.illegal-health-bar')
          .data(d => [d]);

        const illegalBarsEnter = illegalBars.enter()
          .append('rect')
          .attr('class', 'illegal-health-bar')
          .attr('x', 0)
          .attr('width', 0)
          .attr('y', newY1Scale('Illegal'))
          .attr('height', newY1Scale.bandwidth());

        illegalBars.merge(illegalBarsEnter)
          .transition()
          .duration(stepData.step === 3 ? 1400 : 1000)
          .delay((d, i) => i * 400 + 300)
          .attr('x', 0)
          .attr('width', d => xScale(d.illegal))
          .attr('y', newY1Scale('Illegal'))
          .attr('height', newY1Scale.bandwidth())
          .attr('fill', '#e74c3c')
          .style('filter', d => {
            if (d.name === 'Complication Rate' && stepData.step === 3) {
              return 'drop-shadow(0 0 8px rgba(231, 76, 60, 0.6))';
            }
            return 'none';
          });

        // Legal value labels
        const legalLabels = metricGroupsMerge.selectAll('.legal-health-label')
          .data(d => [d]);

        legalLabels.enter()
          .append('text')
          .attr('class', 'legal-health-label')
          .merge(legalLabels)
          .transition()
          .duration(800)
          .delay((d, i) => i * 400 + 600)
          .attr('x', d => xScale(d.legal) + 5)
          .attr('y', newY1Scale('Legal') + newY1Scale.bandwidth()/2 + 4)
          .style('text-anchor', 'start')
          .style('font-size', '12px')
          .style('font-weight', '600')
          .style('fill', '#333')
          .text(d => `${d.legal}% Legal`);

        // Illegal value labels
        const illegalLabels = metricGroupsMerge.selectAll('.illegal-health-label')
          .data(d => [d]);

        illegalLabels.enter()
          .append('text')
          .attr('class', 'illegal-health-label')
          .merge(illegalLabels)
          .transition()
          .duration(800)
          .delay((d, i) => i * 400 + 900)
          .attr('x', d => xScale(d.illegal) + 5)
          .attr('y', newY1Scale('Illegal') + newY1Scale.bandwidth()/2 + 4)
          .style('text-anchor', 'start')
          .style('font-size', '12px')
          .style('font-weight', '600')
          .style('fill', '#333')
          .text(d => `${d.illegal}% Illegal`);



        // Add professional legend
        if (stepIndex === 0) {
          const healthLegend = g.append('g').attr('class', 'health-legend')
            .attr('transform', `translate(${chartWidth - 140}, -40)`);

          healthLegend.append('rect')
            .attr('width', 15).attr('height', 15)
            .attr('fill', '#5a9bd4')
            .attr('rx', 2);
          healthLegend.append('text')
            .attr('x', 20).attr('y', 12)
            .style('font-size', '12px')
            .style('font-weight', '500')
            .style('fill', '#333')
            .text('Legal Transplants');

          healthLegend.append('rect')
            .attr('y', 20)
            .attr('width', 15).attr('height', 15)
            .attr('fill', '#e74c3c')
            .attr('rx', 2);
          healthLegend.append('text')
            .attr('x', 20).attr('y', 32)
            .style('font-size', '12px')
            .style('font-weight', '500')
            .style('fill', '#333')
            .text('Illegal Transplants');
        }
      }

      function playHealthAnimation() {
        if (healthIsPlaying) return;
        healthIsPlaying = true;
        document.getElementById('health-play-btn').textContent = '‚è∏Ô∏è Playing...';
        document.getElementById('health-play-btn').disabled = true;

        function nextHealthStep() {
          if (healthCurrentStep < healthSteps.length - 1) {
            healthCurrentStep++;
            updateHealthChart(healthCurrentStep);
            setTimeout(nextHealthStep, healthCurrentStep === 3 ? 3000 : 2500); // Longer pause for final message
          } else {
            healthIsPlaying = false;
            document.getElementById('health-play-btn').textContent = '‚ñ∂Ô∏è Play Again';
            document.getElementById('health-play-btn').disabled = false;
          }
        }
        nextHealthStep();
      }

      function resetHealthChart() {
        healthCurrentStep = 0;
        healthIsPlaying = false;
        document.getElementById('health-play-btn').textContent = '‚ñ∂Ô∏è Play Animation';
        document.getElementById('health-play-btn').disabled = false;

        updateHealthChart(healthCurrentStep);
      }

      // Initialize health chart
      window.healthChartElements = initHealthChart();
      updateHealthChart(healthCurrentStep);

      // Event listeners
      document.getElementById('health-play-btn').addEventListener('click', playHealthAnimation);
      document.getElementById('health-reset-btn').addEventListener('click', resetHealthChart);

      // Resize handler
      window.addEventListener('resize', function() {
        window.healthChartElements = initHealthChart();
        updateHealthChart(healthCurrentStep);
      });
    });

    // Tableau viz sizing for all 4 charts
    function setupAllVizSizing() {
      const vizIds = ['viz1730995200000', 'viz1730995200001', 'viz1730995200002', 'viz1730995200003'];
      
      vizIds.forEach(function(vizId) {
        const divElement = document.getElementById(vizId);
        if (divElement) {
          const vizElement = divElement.getElementsByTagName('object')[0];
          if (vizElement) {
            function sizeIt() {
              vizElement.style.width = '100%';
              // Make Chart 4 (Long Term Total Cost) much larger than other charts
              const aspectRatio = vizId === 'viz1730995200003' ? 1.2 : 0.75;
              vizElement.style.height = (divElement.offsetWidth * aspectRatio) + 'px'; 
            }
            sizeIt();
            
            // Store resize function for this viz
            divElement._resizeFunction = sizeIt;
          }
        }
      });
    }

    // Initialize sizing on load
    setupAllVizSizing();

    // Handle window resize for all visualizations
    let raf;
    window.addEventListener("resize", () => {
      cancelAnimationFrame(raf);
      raf = requestAnimationFrame(() => {
        ['viz1730995200000', 'viz1730995200001', 'viz1730995200002', 'viz1730995200003'].forEach(function(vizId) {
          const divElement = document.getElementById(vizId);
          if (divElement && divElement._resizeFunction) {
            divElement._resizeFunction();
          }
        });
      });
    });

    // Enable multi-level dropdown on hover for desktop
    document.addEventListener('DOMContentLoaded', function() {
      const dropdownSubmenus = document.querySelectorAll('.dropdown-submenu');
      
      dropdownSubmenus.forEach(function(submenu) {
        submenu.addEventListener('mouseenter', function() {
          const dropdownMenu = this.querySelector('.dropdown-menu');
          if (dropdownMenu) {
            // Remove any previous positioning class
            this.classList.remove('dropstart');
            
            // Show the menu first to get accurate measurements
            dropdownMenu.classList.add('show');
            
            // Small delay to ensure rendering
            setTimeout(() => {
              const rect = dropdownMenu.getBoundingClientRect();
              const viewportWidth = window.innerWidth || document.documentElement.clientWidth;
              
              // Check if menu extends beyond right edge of viewport
              if (rect.right > viewportWidth - 10) {
                this.classList.add('dropstart');
              }
            }, 10);
          }
        });
        
        submenu.addEventListener('mouseleave', function() {
          const dropdownMenu = this.querySelector('.dropdown-menu');
          if (dropdownMenu) {
            dropdownMenu.classList.remove('show');
          }
        });
      });
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
