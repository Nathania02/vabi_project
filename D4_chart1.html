<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Pathways (US vs Iran) — Data Insights</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0}
    .navbar{box-shadow:0 2px 4px rgba(0,0,0,.1);z-index:1000}
    .navbar.sticky-top{background-color:#f8f9fa!important}
    /* multi-level dropdown */
    .dropdown-submenu{position:relative}
    .dropdown-submenu .dropdown-menu{position:absolute;top:0;left:100%;margin-top:-1px;margin-left:-1px;max-height:80vh;overflow-y:auto;min-width:200px}
    .dropdown-submenu.dropstart .dropdown-menu{left:auto;right:100%;margin-left:0;margin-right:-1px}
    .dropdown-submenu:hover>.dropdown-menu{display:block}
    .dropdown-item.has-submenu{position:relative;padding-right:2rem}
    .dropdown-item.has-submenu::after{content:"›";position:absolute;right:1rem;font-weight:700}
    .dropdown-submenu.dropstart .dropdown-item.has-submenu::after{content:"‹"}
    body{overflow-x:hidden}
    .content-wrapper{padding:20px;max-width:1200px;margin:0 auto}
    .breadcrumb-nav{background:#f8f9fa;padding:12px 20px;margin-bottom:20px;border-radius:8px}
    h1{font-size:1.5rem;margin:0 0 10px;color:#333}
    .sub{color:#666;margin:0 0 16px}
    .viz-box{border:1px solid #e5e5e5;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.08)}
    .d3-box{border:1px solid #e5e5e5;border-radius:8px;margin-top:16px;padding:12px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
    #d3chart{width:100%;height:auto}
  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="index.html"><span style="color:#667eea">Data</span> Insights</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle active" href="#" id="dashboardDropdown" role="button" data-bs-toggle="dropdown">Dashboards</a>
            <ul class="dropdown-menu">
              <!-- Human Trafficking topic -->
              <li class="dropdown-submenu">
                <a class="dropdown-item has-submenu" href="#">Human Trafficking</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="D1_chart1.html">Types of Trafficking</a></li>
                  <li><a class="dropdown-item" href="D1_chart5.html">Flow of Trafficking</a></li>
                  <li><a class="dropdown-item" href="D1_chart2.html">Victims trafficked to other countries</a></li>
                  <li><a class="dropdown-item" href="D1_chart3.html">Trend of Victims</a></li>
                  <li><a class="dropdown-item" href="D1_chart4.html">Organ Removal Cases</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item" href="Chart1.html">Solutions — Pathways (US vs Iran)</a></li>
                  <li><a class="dropdown-item" href="Chart2.html">US vs Iran — Spotlight Metrics</a></li>
                  <li><a class="dropdown-item" href="Chart3.html">If We Do Nothing — Cost & Deaths</a></li>
                  <li><a class="dropdown-item" href="Chart4.html">Iran Reforms Timeline</a></li>
                </ul>
              </li>

              <!-- Other topics (placeholders) -->
              <li class="dropdown-submenu">
                <a class="dropdown-item has-submenu" href="#">Global Economics</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="economics-gdp.html">GDP Analysis</a></li>
                </ul>
              </li>
              <li class="dropdown-submenu">
                <a class="dropdown-item has-submenu" href="#">Climate Change</a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="climate-temperature.html">Temperature Trends</a></li>
                </ul>
              </li>
            </ul>
          </li>

          <li class="nav-item"><a class="nav-link" href="index.html#about">About</a></li>
          <li class="nav-item"><a class="nav-link" href="index.html#contact">Contact</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- BREADCRUMB -->
  <div class="breadcrumb-nav">
    <div class="container-fluid">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item"><a href="index.html#trafficking">Human Trafficking</a></li>
          <li class="breadcrumb-item active" aria-current="page">Pathways to More Organs</li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- MAIN -->
  <div class="content-wrapper">
    <h1>Pathways to More Organs</h1>
    <p class="sub">Countries and their different policies vs Type and number of organs</p>

    <!-- TABLEAU -->
    <div class="viz-box">
      <div class="tableauPlaceholder" id="viz1762152321971" style="position: relative">
        <noscript>
          <a href="#"><img alt="Pathways" src="https://public.tableau.com/static/images/Ch/Chart123_17621523095430/Chart1/1_rss.png" style="border:none"/></a>
        </noscript>
        <object class="tableauViz" style="display:none">
          <param name="host_url" value="https%3A%2F%2Fpublic.tableau.com%2F"/>
          <param name="embed_code_version" value="3"/>
          <param name="site_root" value=""/>
          <param name="name" value="Chart123_17621523095430&#47;Chart1"/>
          <param name="tabs" value="no"/>
          <param name="toolbar" value="yes"/>
          <param name="static_image" value="https://public.tableau.com/static/images/Ch/Chart123_17621523095430/Chart1/1.png"/>
          <param name="animate_transition" value="yes"/>
          <param name="display_static_image" value="yes"/>
          <param name="display_spinner" value="yes"/>
          <param name="display_overlay" value="yes"/>
          <param name="display_count" value="yes"/>
          <param name="language" value="en-GB"/>
          <param name="filter" value="publish=yes"/>
        </object>
      </div>
    </div>

  <!-- Scripts -->
  <script src="https://public.tableau.com/javascripts/api/viz_v1.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    // Responsive Tableau sizing
    (function(){
      const divEl=document.getElementById("viz1762152321971");
      const vizEl=divEl.getElementsByTagName("object")[0];
      function sizeIt(){ vizEl.style.width="100%"; vizEl.style.height=Math.max(360, divEl.offsetWidth*0.62)+"px"; }
      sizeIt();
      let raf; window.addEventListener("resize",()=>{ cancelAnimationFrame(raf); raf=requestAnimationFrame(sizeIt); });
    })();

    // Flip submenus to left if overflowing
    document.addEventListener('DOMContentLoaded',function(){
      document.querySelectorAll('.dropdown-submenu').forEach(sm=>{
        sm.addEventListener('mouseenter',function(){
          const menu=this.querySelector('.dropdown-menu'); if(!menu) return;
          this.classList.remove('dropstart'); menu.classList.add('show');
          setTimeout(()=>{ const r=menu.getBoundingClientRect(); const vw=innerWidth||document.documentElement.clientWidth;
            if(r.right>vw-10) this.classList.add('dropstart'); },10);
        });
        sm.addEventListener('mouseleave',function(){ const menu=this.querySelector('.dropdown-menu'); if(menu) menu.classList.remove('show'); });
      });
    });

    // Tableau → D3 bridge
    (function(){
      const WORKSHEET_NAME=null, DIM_FIELD=null, MEASURE_FIELD=null;

      function onTableauReady(cb){
        const check=()=>{ if(window.tableau&&tableau.VizManager&&tableau.VizManager.getVizs().length){
          const viz=tableau.VizManager.getVizs()[0];
          try{ viz.addEventListener(tableau.TableauEventName.FIRST_INTERACTIVE,()=>cb(viz)); }catch(e){ cb(viz); }
        } else setTimeout(check,100); }; check();
      }

      const svg=d3.select("#d3chart");
      const [ , , W, H ]=svg.attr("viewBox").split(" ").map(Number);
      const M={top:16,right:24,bottom:48,left:64}, innerW=W-M.left-M.right, innerH=H-M.top-M.bottom;
      const g=svg.append("g").attr("transform",`translate(${M.left},${M.top})`);
      const x=d3.scaleBand().padding(0.2).range([0,innerW]);
      const y=d3.scaleLinear().range([innerH,0]);
      const xAxisG=g.append("g").attr("transform",`translate(0,${innerH})`);
      const yAxisG=g.append("g");
      const tip=d3.select("body").append("div").style("position","fixed").style("pointer-events","none")
        .style("background","rgba(0,0,0,.75)").style("color","#fff").style("padding","6px 8px")
        .style("border-radius","6px").style("font-size","12px").style("opacity",0);
      function showTip(html,x,y){ tip.html(html).style("left",(x+12)+"px").style("top",(y+12)+"px").transition().duration(150).style("opacity",1); }
      function hideTip(){ tip.transition().duration(150).style("opacity",0); }

      function render(rows,dim,measure){
        const data=rows.map(d=>({label:String(d[dim]),value:+d[measure]})).filter(d=>d.label&&!isNaN(d.value));
        x.domain(data.map(d=>d.label)); y.domain([0,d3.max(data,d=>d.value)||0]).nice();
        xAxisG.transition().duration(500).call(d3.axisBottom(x)).selectAll("text").style("font-size","11px").attr("dy",".75em");
        yAxisG.transition().duration(500).call(d3.axisLeft(y).ticks(6)).selectAll("text").style("font-size","11px");
        const bars=g.selectAll("rect").data(data,d=>d.label);
        bars.exit().transition().duration(400).attr("y",y(0)).attr("height",0).remove();
        bars.transition().duration(600).attr("x",d=>x(d.label)).attr("y",d=>y(d.value))
            .attr("width",x.bandwidth()).attr("height",d=>y(0)-y(d.value));
        bars.enter().append("rect").attr("x",d=>x(d.label)).attr("width",x.bandwidth())
            .attr("y",y(0)).attr("height",0)
            .on("mousemove",(ev,d)=>showTip(`<strong>${d.label}</strong><br>Value: ${d3.format(",.2f")(d.value)}`,ev.clientX,ev.clientY))
            .on("mouseleave",hideTip)
            .transition().duration(600).attr("y",d=>y(d.value)).attr("height",d=>y(0)-y(d.value));
      }

      function summaryToRows(table){
        const cols=table.getColumns().map(c=>c.getFieldName());
        return table.getData().map(row=>{ const obj={}; row.forEach((cell,i)=>obj[cols[i]]=cell.formattedValue??cell.value); return obj; });
      }
      function marksToRows(marks){ return marks.map(m=>{ const o={}; m.getPairs().forEach(p=>o[p.fieldName]=p.value); return o; }); }
      function pickFields(rows){
        if(!rows.length) return {dim:null,measure:null};
        if(DIM_FIELD&&MEASURE_FIELD) return {dim:DIM_FIELD,measure:MEASURE_FIELD};
        const sample=rows[0]; let dim=null, measure=null;
        for(const k of Object.keys(sample)){ const v=sample[k], isNum=(typeof v==="number")||(!isNaN(+v)&&v!=="");
          if(!isNum&&!dim) dim=k; if(isNum&&!measure) measure=k; if(dim&&measure) break; }
        return {dim,measure};
      }

      async function fetchData(ws,preferSelection=true){
        try{
          if(preferSelection){
            const sel=await ws.getSelectedMarksAsync(); const marks=sel.getMarks();
            if(marks&&marks.length) return marksToRows(marks);
          }
          const table=await ws.getSummaryDataAsync({ignoreSelection:false});
          return summaryToRows(table);
        }catch(e){ console.warn("Data fetch failed:",e); return []; }
      }

      onTableauReady(async (viz)=>{
        const wb=viz.getWorkbook(); let sheet=wb.getActiveSheet(), ws;
        if(sheet.getSheetType&&sheet.getSheetType()==="dashboard"){
          const wss=sheet.getWorksheets();
          ws=WORKSHEET_NAME ? wss.find(w=>w.getName()===WORKSHEET_NAME) : wss[0];
        } else { ws=sheet; }

        async function refresh(preferSelection=true){
          const rows=await fetchData(ws,preferSelection);
          const {dim,measure}=pickFields(rows);
          if(!dim||!measure){ console.warn("Set WORKSHEET_NAME/DIM_FIELD/MEASURE_FIELD if auto-pick fails."); return; }
          render(rows,dim,measure);
        }
        await refresh(false);
        viz.addEventListener(tableau.TableauEventName.MARKS_SELECTION,()=>refresh(true));
        viz.addEventListener(tableau.TableauEventName.FILTER_CHANGE,()=>refresh(false));
      });
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
